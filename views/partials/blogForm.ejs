<% if (locals.blog) { %>
  <div class="modal fade" id="formModal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-flex-container">
      <div class="modal-dialog">
        <form action="/blogs" class="modal-content" id="blog-form" data-blog-id="<%= blog.id %>">
          <div class="modal-header">
            <h5 class="modal-title" id="formModalLabel"><%= blog.id ? "Edit blogpost" : "Create new blogpost"%></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
 
          <!-- Inputs -->
          <div class="modal-body">
            <div class="formModal__input-container">
              <label for="title">Title<span class="formModal__asterisk">*</span></label>
              <input type="text" name="title" id="title" value="<%= blog.title %>">
            </div>
            <div class="formModal__input-container">
              <label for="abstract">Abstract<span class="formModal__asterisk">*</span></label>
              <input type="text" name="abstract" id="abstract" value="<%= blog.abstract %>">
            </div>
            <div class="formModal__input-container">
              <label for="blogBody">Body<span class="formModal__asterisk">*</span></label>
              <textarea rows="3" name="blogBody" id="blogBody"><%= blog.blogBody %></textarea>
            </div>
            <div class="formModal__input-container">
              <label for="imageUrl">Image</label>
              <input type="text" name="imageUrl" id="imageUrl" />
            </div>
            <div class="formModal__input-container">
              <label for="imageAltText">Image alternative text</label>
              <input type="text" name="imageAltText" id="imageAltText" value="<%= blog.imageAltText %>"></input>
            </div>
 
            <h6><i>Fields with an asterisk (<span class="formModal__asterisk">*</span>) are required.</i></h6>
          </div>
          <!-- /Inputs -->
 
          <!-- Buttons -->
          <div class="modal-footer">
            <button type="button" class="project-button modal__button" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="project-continue-button modal__button">Save changes</button>
          </div>
          <!-- /Buttons -->
        </form>
      </div>
    </div>
  </div>

  <script>
    const blogForm = document.getElementById('blog-form');
   
    blogForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const blogId = blogForm.getAttribute('data-blog-id');
     
      if (blogId) {
        const formValues = {};
        formValues.id = blogId;
        formValues.title = document.getElementById('title').value; //keys
        formValues.abstract = document.getElementById('abstract').value;
        formValues.blogBody = document.getElementById('blogBody').value;
        formValues.imageAltText = document.getElementById('imageAltText').value;


        fetch('/blogs', {
          method: 'PUT',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formValues)
        })
          .then(response => {
            if (response.status === 200) {
              alert('Blogpost successfully edited!');
              document.location.reload();
            } else {
              alert('An error has occurred. Please, try again later.');
              throw new Error('An error has occurred. Please, try again later.');
            }
          })
          .catch((err) => {
            console.error(err);
          });


      } else {
        blogForm.setAttribute('method', 'POST');
        blogForm.submit();
      }
    });
  </script>
<% } %>
